language: python
python:
  - 2.7

sudo: false
env:
# commenting this out to save time because we know it would fail until python 2.6
# support won't be restored.
#  - TOX_ENV=py26-dj16-cms30
#  - TOX_ENV=py26-dj16-cms31
#  - TOX_ENV=py26-dj17-cms30
#  - TOX_ENV=py26-dj17-cms31
  matrix:
    - TOX_ENV=py27-dj16-cms30
    - TOX_ENV=py27-dj16-cms31
    - TOX_ENV=py27-dj17-cms30
    - TOX_ENV=py27-dj17-cms31
    - TOX_ENV=pep8
  global:
    - secure: ghtK6PdDy13ruL+HGT4doVcUkl8pyzukY1gkHbkIAL8BrOc0eQdGBnAxKpPGZJv/8upWyul69DgXKg26cbS633Gfp0NjM/YPUh6wEgTg46Zjirw1ejX7xmqsQUGukZXOXNsll7/Syql+KEn8ao+JOAh+gjkFfNY2mxD6Oxs56Sc=
    - secure: Vd/CeUcWVUsgejibIiq8PQT1xfK7SYRdWSdol6ymGb2LVI5ckm4rOGm+FBdbKip43oqgpkM7sLqBzSUTVTsGdea87tiKJKpp4AXaKTgkzG9LzY6eX67fnWvG2WOfTdrLIeUwjY/HVlAQC8ymaZ09Nj6Rhb7dKoziEW7+uqGjGjo=
    - secure: gRrsTzeBs+2N7pi95FQ4lhhAzqXlwsVR8fBwPfYVY6s+kqFzyh7KeFuy2uH5JiS3MPP+XIihT9r6jf5rmmhoLIGTEpos3HZYGkaSEPSPybvNVdVoTnMzaNlrMdCLgw1/S15K1luhyR6PqvfVxoD+PTUNeT0s/YUuxMpsuvMgGtE=

# PEP8 is mandatory
# matrix:
#   allow_failures:
#     - env: TOX_ENV=pep8

before_install:
  - npm install -g npm

install:
  - pip install tox coveralls

before_script:
  - npm install -g gulp
  - npm install -g codeclimate-test-reporter
  - npm install

after_script:
  - codeclimate < tests/coverage/**/lcov.info

script:
  - tox -e $TOX_ENV
  - gulp tests

after_success:
  - coveralls

notifications:
  webhooks: http://addons.us-iad-rs.aldryn.io/en/travis-endpoint/
